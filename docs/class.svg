<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="421px" preserveAspectRatio="none" style="width:541px;height:421px;" version="1.1" viewBox="0 0 541 421" width="541px" zoomAndPan="magnify"><defs><filter height="300%" id="f12pbznpgj0c77" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--class ICancelable--><rect fill="#FEFECE" filter="url(#f12pbznpgj0c77)" height="75.6719" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="37" y="315.5"/><ellipse cx="52" cy="331.5" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M52.9844,336.4063 L53.7188,336.4063 L53.7188,337.8594 L49.7188,337.8594 L49.7188,336.4063 L50.4531,336.4063 L50.4531,326.375 L49.7188,326.375 L49.7188,324.9219 L53.7188,324.9219 L53.7188,326.375 L52.9844,326.375 L52.9844,336.4063 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="66" y="336.4102">ICancelable</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="38" x2="136" y1="347.5" y2="347.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="38" x2="136" y1="355.5" y2="355.5"/><ellipse cx="48" cy="367.918" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="47" x="57" y="370.9189">bool Do()</text><ellipse cx="48" cy="381.7539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="66" x="57" y="384.7549">void Cancel()</text><!--class CancelableProcessBase--><rect fill="#FEFECE" filter="url(#f12pbznpgj0c77)" height="103.3438" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="6" y="131"/><ellipse cx="21" cy="147" fill="#A9DCDF" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M18.8594,152.8594 L16.2656,152.8594 L19.5938,139.9219 L21.9219,139.9219 L25.2344,152.8594 L22.6406,152.8594 L21.7188,149.0781 L19.7969,149.0781 L18.8594,152.8594 Z M20.3125,143.4375 L20.3125,143.4375 L20.125,147.8125 L21.375,147.8125 L20.3125,143.4375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="136" x="35" y="151.9102">CancelableProcessBase</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="173" y1="163" y2="163"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="173" y1="171" y2="171"/><ellipse cx="17" cy="183.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="26" y="186.4189">bool Do()</text><ellipse cx="17" cy="197.2539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="64" x="26" y="200.2549">void Cancel()</text><polygon fill="#FFFF44" points="17,206.0898,21,210.0898,17,214.0898,13,210.0898" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="26" y="214.0908">bool DoImpl()</text><polygon fill="#FFFF44" points="17,219.9258,21,223.9258,17,227.9258,13,223.9258" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="127" x="26" y="227.9268">bool ShouldCancel() const</text><!--class ConcreteProcess--><rect fill="#FEFECE" filter="url(#f12pbznpgj0c77)" height="61.8359" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="50" y="8"/><ellipse cx="65" cy="24" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M67.7031,29.4375 Q66.7813,30.3594 64.5156,30.3594 Q63.25,30.3594 62.3281,29.4375 Q60.6719,27.7813 60.6719,24.25 Q60.6719,20.1406 62.4531,18.3438 Q63.3906,17.4219 64.5781,17.4219 Q66.8438,17.4219 67.5781,18.1406 Q68.9688,19.5469 68.9063,21.9375 L66.4375,21.9375 Q66.375,19.8125 65.6406,19.0781 Q65.25,18.6719 64.5781,18.6719 Q64.5781,18.6719 64.5156,19.1406 Q63.1875,20.4688 63.1875,24.125 Q63.1875,27.3125 64.3281,28.4375 Q64.8594,28.9688 64.8594,28.9688 Q65.1094,28.9688 65.6406,28.4375 Q66.3125,27.7813 66.375,25.3906 L68.9688,25.3906 Q68.7656,28.375 67.7031,29.4375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="79" y="28.9102">ConcreteProcess</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="51" x2="177" y1="40" y2="40"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="51" x2="177" y1="48" y2="48"/><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="58" y="57.418"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="62" x="70" y="63.4189">bool DoImpl()</text><!--class CProgressDialog--><rect fill="#FEFECE" filter="url(#f12pbznpgj0c77)" height="117.1797" style="stroke: #A80036; stroke-width: 1.5;" width="294" x="238" y="295"/><ellipse cx="332.75" cy="311" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M335.4531,316.4375 Q334.5313,317.3594 332.2656,317.3594 Q331,317.3594 330.0781,316.4375 Q328.4219,314.7813 328.4219,311.25 Q328.4219,307.1406 330.2031,305.3438 Q331.1406,304.4219 332.3281,304.4219 Q334.5938,304.4219 335.3281,305.1406 Q336.7188,306.5469 336.6563,308.9375 L334.1875,308.9375 Q334.125,306.8125 333.3906,306.0781 Q333,305.6719 332.3281,305.6719 Q332.3281,305.6719 332.2656,306.1406 Q330.9375,307.4688 330.9375,311.125 Q330.9375,314.3125 332.0781,315.4375 Q332.6094,315.9688 332.6094,315.9688 Q332.8594,315.9688 333.3906,315.4375 Q334.0625,314.7813 334.125,312.3906 L336.7188,312.3906 Q336.5156,315.375 335.4531,316.4375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="353.25" y="315.9102">CProgressDialog</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="239" x2="531" y1="327" y2="327"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="239" x2="531" y1="335" y2="335"/><ellipse cx="249" cy="347.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="268" x="258" y="350.4189">CProgressDialog(CWnd*, std::shared_ptr&lt;ICancelable&gt;)</text><ellipse cx="249" cy="361.2539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="96" x="258" y="364.2549">BOOL OnInitDialog()</text><polygon fill="#FFFF44" points="249,370.0898,253,374.0898,249,378.0898,245,374.0898" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="266" x="258" y="378.0908">LRESULT OnCloseProgressDialog(WPARAM, LPARAM)</text><ellipse cx="249" cy="388.9258" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="125" x="258" y="391.9268">void OnBnClickedCancel()</text><ellipse cx="249" cy="402.7617" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="148" x="258" y="405.7627">void ActionWhenThreadEnds()</text><!--class MainDialog--><rect fill="#FEFECE" filter="url(#f12pbznpgj0c77)" height="61.8359" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="258" y="8"/><ellipse cx="309.75" cy="24" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M312.4531,29.4375 Q311.5313,30.3594 309.2656,30.3594 Q308,30.3594 307.0781,29.4375 Q305.4219,27.7813 305.4219,24.25 Q305.4219,20.1406 307.2031,18.3438 Q308.1406,17.4219 309.3281,17.4219 Q311.5938,17.4219 312.3281,18.1406 Q313.7188,19.5469 313.6563,21.9375 L311.1875,21.9375 Q311.125,19.8125 310.3906,19.0781 Q310,18.6719 309.3281,18.6719 Q309.3281,18.6719 309.2656,19.1406 Q307.9375,20.4688 307.9375,24.125 Q307.9375,27.3125 309.0781,28.4375 Q309.6094,28.9688 309.6094,28.9688 Q309.8594,28.9688 310.3906,28.4375 Q311.0625,27.7813 311.125,25.3906 L313.7188,25.3906 Q313.5156,28.375 312.4531,29.4375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="62" x="330.25" y="28.9102">MainDialog</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="259" x2="431" y1="40" y2="40"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="259" x2="431" y1="48" y2="48"/><ellipse cx="269" cy="60.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="148" x="278" y="63.4189">void OnBnClickedBtnProcess()</text><path d="M89.0999,234.206 C88.7602,253.341 88.3714,275.245 88.0214,294.961 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="95.015,295.389,87.661,315.2619,81.0172,295.141,95.015,295.389" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M108.91,70.009 C106.871,82.029 104.4289,96.43 101.9871,110.826 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="108.824,112.379,98.5777,130.927,95.0208,110.038,108.824,112.379" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M142.552,353.5 C169.713,353.5 203.82,353.5 237.803,353.5 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="137.215,353.5,146.215,357.5,142.215,353.5,146.215,349.5,137.215,353.5" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="155.5" y="346.9951">m_process</text><path d="M178.066,39 C204.693,39 231.32,39 257.947,39 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><path d="M348.872,70.248 C355.499,122.021 369.121,228.445 377.614,294.8 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--
@startuml

interface ICancelable {
  +{abstract} bool Do()
  +{abstract} void Cancel()
}

abstract CancelableProcessBase {
  +bool Do()
  +void Cancel()
  #{abstract} bool DoImpl()
  #bool ShouldCancel() const
}

class ConcreteProcess {
  -bool DoImpl()
}

ICancelable <|.u. CancelableProcessBase
CancelableProcessBase <|-u- ConcreteProcess

class CProgressDialog {
  +CProgressDialog(CWnd*, std::shared_ptr<ICancelable>)
  +BOOL OnInitDialog()
  #LRESULT OnCloseProgressDialog(WPARAM, LPARAM)
  +void OnBnClickedCancel()
  +void ActionWhenThreadEnds()
}

class MainDialog {
  +void OnBnClickedBtnProcess()
}

CProgressDialog -l-> ICancelable : m_process

MainDialog .l. ConcreteProcess
MainDialog .d. CProgressDialog

@enduml

PlantUML version 2017.11(Thu Apr 20 01:18:59 JST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_121-b13
Operating System: Windows 10
OS Version: 10.0
Default Encoding: MS932
Language: ja
Country: JP
--></g></svg>