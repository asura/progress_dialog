<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="396px" preserveAspectRatio="none" style="width:518px;height:396px;" version="1.1" viewBox="0 0 518 396" width="518px" zoomAndPan="magnify"><defs><filter height="300%" id="f1xdbkxe23zxxv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--class ICancelable--><rect fill="#FEFECE" filter="url(#f1xdbkxe23zxxv)" height="75.6719" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="36" y="312"/><ellipse cx="51" cy="328" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M51.9844,332.9063 L52.7188,332.9063 L52.7188,334.3594 L48.7188,334.3594 L48.7188,332.9063 L49.4531,332.9063 L49.4531,322.875 L48.7188,322.875 L48.7188,321.4219 L52.7188,321.4219 L52.7188,322.875 L51.9844,322.875 L51.9844,332.9063 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="65" y="332.9102">ICancelable</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="37" x2="135" y1="344" y2="344"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="37" x2="135" y1="352" y2="352"/><ellipse cx="47" cy="364.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="47" x="56" y="367.4189">bool Do()</text><ellipse cx="47" cy="378.2539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="66" x="56" y="381.2549">void Cancel()</text><!--class CancelableProcessBase--><rect fill="#FEFECE" filter="url(#f1xdbkxe23zxxv)" height="103.3438" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="6" y="131"/><ellipse cx="21" cy="147" fill="#A9DCDF" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M18.8594,152.8594 L16.2656,152.8594 L19.5938,139.9219 L21.9219,139.9219 L25.2344,152.8594 L22.6406,152.8594 L21.7188,149.0781 L19.7969,149.0781 L18.8594,152.8594 Z M20.3125,143.4375 L20.3125,143.4375 L20.125,147.8125 L21.375,147.8125 L20.3125,143.4375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="136" x="35" y="151.9102">CancelableProcessBase</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="173" y1="163" y2="163"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="173" y1="171" y2="171"/><ellipse cx="17" cy="183.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="26" y="186.4189">bool Do()</text><ellipse cx="17" cy="197.2539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="64" x="26" y="200.2549">void Cancel()</text><polygon fill="#FFFF44" points="17,206.0898,21,210.0898,17,214.0898,13,210.0898" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="26" y="214.0908">bool DoImpl()</text><polygon fill="#FFFF44" points="17,219.9258,21,223.9258,17,227.9258,13,223.9258" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="127" x="26" y="227.9268">bool ShouldCancel() const</text><!--class ConcreteProcess--><rect fill="#FEFECE" filter="url(#f1xdbkxe23zxxv)" height="61.8359" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="40" y="8"/><ellipse cx="55" cy="24" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M57.7031,29.4375 Q56.7813,30.3594 54.5156,30.3594 Q53.25,30.3594 52.3281,29.4375 Q50.6719,27.7813 50.6719,24.25 Q50.6719,20.1406 52.4531,18.3438 Q53.3906,17.4219 54.5781,17.4219 Q56.8438,17.4219 57.5781,18.1406 Q58.9688,19.5469 58.9063,21.9375 L56.4375,21.9375 Q56.375,19.8125 55.6406,19.0781 Q55.25,18.6719 54.5781,18.6719 Q54.5781,18.6719 54.5156,19.1406 Q53.1875,20.4688 53.1875,24.125 Q53.1875,27.3125 54.3281,28.4375 Q54.8594,28.9688 54.8594,28.9688 Q55.1094,28.9688 55.6406,28.4375 Q56.3125,27.7813 56.375,25.3906 L58.9688,25.3906 Q58.7656,28.375 57.7031,29.4375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="69" y="28.9102">ConcreteProcess</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="41" x2="167" y1="40" y2="40"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="41" x2="167" y1="48" y2="48"/><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="48" y="57.418"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="62" x="60" y="63.4189">bool DoImpl()</text><!--class WorkerThreadManager--><rect fill="#FEFECE" filter="url(#f1xdbkxe23zxxv)" height="75.6719" style="stroke: #A80036; stroke-width: 1.5;" width="254" x="237" y="312"/><ellipse cx="296.75" cy="328" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M299.4531,333.4375 Q298.5313,334.3594 296.2656,334.3594 Q295,334.3594 294.0781,333.4375 Q292.4219,331.7813 292.4219,328.25 Q292.4219,324.1406 294.2031,322.3438 Q295.1406,321.4219 296.3281,321.4219 Q298.5938,321.4219 299.3281,322.1406 Q300.7188,323.5469 300.6563,325.9375 L298.1875,325.9375 Q298.125,323.8125 297.3906,323.0781 Q297,322.6719 296.3281,322.6719 Q296.3281,322.6719 296.2656,323.1406 Q294.9375,324.4688 294.9375,328.125 Q294.9375,331.3125 296.0781,332.4375 Q296.6094,332.9688 296.6094,332.9688 Q296.8594,332.9688 297.3906,332.4375 Q298.0625,331.7813 298.125,329.3906 L300.7188,329.3906 Q300.5156,332.375 299.4531,333.4375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="126" x="317.25" y="332.9102">WorkerThreadManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="238" x2="490" y1="344" y2="344"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="238" x2="490" y1="352" y2="352"/><ellipse cx="248" cy="364.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="228" x="257" y="367.4189">void push_back(std::shared_ptr&lt;ICancelable&gt;);</text><ellipse cx="248" cy="378.2539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="112" x="257" y="381.2549">bool get_result() const;</text><!--class CProgressDialog--><rect fill="#FEFECE" filter="url(#f1xdbkxe23zxxv)" height="89.5078" style="stroke: #A80036; stroke-width: 1.5;" width="294" x="215" y="137.5"/><ellipse cx="309.75" cy="153.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M312.4531,158.9375 Q311.5313,159.8594 309.2656,159.8594 Q308,159.8594 307.0781,158.9375 Q305.4219,157.2813 305.4219,153.75 Q305.4219,149.6406 307.2031,147.8438 Q308.1406,146.9219 309.3281,146.9219 Q311.5938,146.9219 312.3281,147.6406 Q313.7188,149.0469 313.6563,151.4375 L311.1875,151.4375 Q311.125,149.3125 310.3906,148.5781 Q310,148.1719 309.3281,148.1719 Q309.3281,148.1719 309.2656,148.6406 Q307.9375,149.9688 307.9375,153.625 Q307.9375,156.8125 309.0781,157.9375 Q309.6094,158.4688 309.6094,158.4688 Q309.8594,158.4688 310.3906,157.9375 Q311.0625,157.2813 311.125,154.8906 L313.7188,154.8906 Q313.5156,157.875 312.4531,158.9375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="330.25" y="158.4102">CProgressDialog</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="216" x2="508" y1="169.5" y2="169.5"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="216" x2="508" y1="177.5" y2="177.5"/><ellipse cx="226" cy="189.918" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="268" x="235" y="192.9189">CProgressDialog(CWnd*, std::shared_ptr&lt;ICancelable&gt;)</text><polygon fill="#FFFF44" points="226,198.7539,230,202.7539,226,206.7539,222,202.7539" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="96" x="235" y="206.7549">BOOL OnInitDialog()</text><ellipse cx="226" cy="217.5898" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="125" x="235" y="220.5908">void OnBnClickedCancel()</text><!--class MainDialog--><rect fill="#FEFECE" filter="url(#f1xdbkxe23zxxv)" height="61.8359" style="stroke: #A80036; stroke-width: 1.5;" width="174" x="244" y="8"/><ellipse cx="295.75" cy="24" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M298.4531,29.4375 Q297.5313,30.3594 295.2656,30.3594 Q294,30.3594 293.0781,29.4375 Q291.4219,27.7813 291.4219,24.25 Q291.4219,20.1406 293.2031,18.3438 Q294.1406,17.4219 295.3281,17.4219 Q297.5938,17.4219 298.3281,18.1406 Q299.7188,19.5469 299.6563,21.9375 L297.1875,21.9375 Q297.125,19.8125 296.3906,19.0781 Q296,18.6719 295.3281,18.6719 Q295.3281,18.6719 295.2656,19.1406 Q293.9375,20.4688 293.9375,24.125 Q293.9375,27.3125 295.0781,28.4375 Q295.6094,28.9688 295.6094,28.9688 Q295.8594,28.9688 296.3906,28.4375 Q297.0625,27.7813 297.125,25.3906 L299.7188,25.3906 Q299.5156,28.375 298.4531,29.4375 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="62" x="316.25" y="28.9102">MainDialog</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="245" x2="417" y1="40" y2="40"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="245" x2="417" y1="48" y2="48"/><ellipse cx="255" cy="60.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="148" x="264" y="63.4189">void OnBnClickedBtnProcess()</text><path d="M88.7781,234.055 C88.3374,252.288 87.837,272.993 87.3835,291.7575 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="none" points="94.3784,292.0593,86.8971,311.8843,80.3824,291.721,94.3784,292.0593" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M101.031,70.009 C99.8417,82.029 98.4169,96.43 96.9925,110.826 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="103.9389,111.714,95.0037,130.927,90.007,110.335,103.9389,111.714" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M362.536,227.851 C362.832,252.344 363.198,282.604 363.489,306.7538 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="363.551,311.8102,367.4417,302.7624,363.4904,306.8106,359.4423,302.8593,363.551,311.8102" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="364" y="278.4951">m_task_manager</text><path d="M141.081,350 C168.623,350 203.191,350 236.828,350 " fill="none" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="136.022,350,145.022,354,141.022,350,145.022,346,136.022,350" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="154.5" y="343.4951">m_process</text><path d="M168.287,39 C193.499,39 218.711,39 243.923,39 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><path d="M337.574,70.009 C341.858,89.56 347.52,115.407 352.315,137.292 " fill="none" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--
@startuml

interface ICancelable {
  +{abstract} bool Do()
  +{abstract} void Cancel()
}

abstract CancelableProcessBase {
  +bool Do()
  +void Cancel()
  #{abstract} bool DoImpl()
  #bool ShouldCancel() const
}

class ConcreteProcess {
  -bool DoImpl()
}

ICancelable <|.u. CancelableProcessBase
CancelableProcessBase <|-u- ConcreteProcess

class WorkerThreadManager {
	+void push_back(std::shared_ptr<ICancelable>);
	+bool get_result() const;
}

class CProgressDialog {
  +CProgressDialog(CWnd*, std::shared_ptr<ICancelable>)
  #BOOL OnInitDialog()
  +void OnBnClickedCancel()
}

class MainDialog {
  +void OnBnClickedBtnProcess()
}

CProgressDialog -d-> WorkerThreadManager : m_task_manager

WorkerThreadManager -l-> ICancelable : m_process

MainDialog .l. ConcreteProcess
MainDialog .d. CProgressDialog

@enduml

PlantUML version 2017.11(Thu Apr 20 01:18:59 JST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_121-b13
Operating System: Windows 10
OS Version: 10.0
Default Encoding: MS932
Language: ja
Country: JP
--></g></svg>